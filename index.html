<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Itinerary Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        /* Header Section */
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-title h1 {
            font-size: 2.2em;
            font-weight: 700;
        }

        .header-badges {
            display: flex;
            gap: 15px;
        }

        .badge {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trip-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .overview-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .overview-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .overview-value {
            font-size: 1.3em;
            font-weight: 700;
        }

        /* Stats Section */
        .stats-section {
            padding: 40px;
            background: #f8fafc;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(102,126,234,0.25);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            border-radius: 0 0 0 100%;
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #64748b;
            font-size: 0.95em;
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            padding: 40px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }

        /* Sidebar Panels */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .panel {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .panel:hover {
            box-shadow: 0 8px 30px rgba(102,126,234,0.2);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .panel-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
        }

        /* Flight Card */
        .flight-route {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f0f4ff 0%, #f8f0ff 100%);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .airport {
            text-align: center;
        }

        .airport-code {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .airport-name {
            font-size: 0.85em;
            color: #64748b;
        }

        .flight-arrow {
            font-size: 2.5em;
            color: #667eea;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .flight-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .detail-box {
            background: #f8fafc;
            padding: 15px;
            border-radius: 12px;
            border-left: 3px solid #667eea;
        }

        .detail-label {
            font-size: 0.8em;
            color: #64748b;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .detail-value {
            font-size: 1.05em;
            font-weight: 600;
            color: #1e293b;
        }

        /* Hotel Card */
        .hotel-showcase {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .hotel-image-wrapper {
            position: relative;
            width: 140px;
            height: 140px;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .hotel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .hotel-image-wrapper:hover .hotel-image {
            transform: scale(1.2);
        }

        .zoom-indicator {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 8px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .hotel-details {
            flex: 1;
        }

        .hotel-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .hotel-rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .stars {
            color: #fbbf24;
            font-size: 1.1em;
        }

        .reviews {
            color: #64748b;
            font-size: 0.9em;
        }

        .hotel-price {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
        }

        .hotel-price span {
            font-size: 0.6em;
            color: #64748b;
            font-weight: 500;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .amenity {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            color: #475569;
        }

        .amenity-icon {
            color: #667eea;
            font-size: 1.1em;
        }

        /* Budget Panel */
        .budget-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            color: white;
            margin-bottom: 20px;
        }

        .budget-total {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .budget-subtitle {
            opacity: 0.9;
            font-size: 0.95em;
        }

        .budget-breakdown {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .budget-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .budget-row:hover {
            background: #f0f4ff;
            transform: translateX(5px);
        }

        .budget-row-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .budget-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .budget-category {
            font-weight: 600;
            color: #1e293b;
        }

        .budget-amount {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1em;
        }

        /* Itinerary Section */
        .itinerary-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .day-accordion {
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .day-accordion:hover {
            box-shadow: 0 8px 30px rgba(102,126,234,0.2);
        }

        .day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .day-header:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a428f 100%);
        }

        .day-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .day-number-badge {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6em;
            font-weight: 700;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .day-info h3 {
            font-size: 1.4em;
            margin-bottom: 8px;
        }

        .day-info-meta {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            opacity: 0.95;
        }

        .day-info-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .day-expand {
            font-size: 2em;
            transition: transform 0.3s ease;
        }

        .day-expand.active {
            transform: rotate(180deg);
        }

        .day-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .day-content.active {
            max-height: 7000px;
        }

        .day-body {
            padding: 30px;
            background: #fafbfc;
        }

        .weather-card {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weather-icon {
            font-size: 2.5em;
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 16px;
            overflow: hidden;
            margin: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        /* Place Accordion */
        .places-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 25px;
        }

        .place-item {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .place-item:hover {
            box-shadow: 0 6px 25px rgba(102,126,234,0.2);
        }

        .place-header {
            padding: 20px 25px;
            cursor: pointer;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .place-header:hover {
            background: #f8fafc;
        }

        .place-header-left {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .place-number-badge {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2em;
        }

        .place-info {
            flex: 1;
        }

        .place-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }

        .place-why {
            font-size: 0.9em;
            color: #667eea;
            font-style: italic;
        }

        .place-time {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            margin-right: 15px;
        }

        .place-expand {
            font-size: 1.8em;
            color: #667eea;
            transition: transform 0.3s ease;
        }

        .place-expand.active {
            transform: rotate(180deg);
        }

        .place-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .place-content.active {
            max-height: 2500px;
        }

        .place-body {
            padding: 25px;
            background: #fafbfc;
            border-top: 2px solid #f1f5f9;
        }

        .place-description {
            color: #475569;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .activities-box {
            background: linear-gradient(135deg, #f0f4ff 0%, #f8f0ff 100%);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .activities-box h5 {
            color: #667eea;
            font-size: 1em;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .activities-box ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .activities-box li {
            display: flex;
            align-items: start;
            gap: 12px;
            color: #475569;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .activities-box li::before {
            content: "‚úì";
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }

        .place-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-box {
            background: white;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(102,126,234,0.2);
        }

        .stat-box-label {
            font-size: 0.8em;
            color: #64748b;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-box-value {
            font-size: 1.1em;
            font-weight: 700;
            color: #1e293b;
        }

        .tips-card {
            background: #fff9e6;
            border: 2px solid #fbbf24;
            padding: 18px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .tips-card h5 {
            color: #92400e;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tips-card p {
            color: #78350f;
            line-height: 1.7;
            margin: 8px 0;
        }

        .place-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 28px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: none;
            font-size: 0.95em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f0f4ff;
            transform: translateY(-3px);
        }

        /* Packing & Checklist */
        .packing-section {
            padding: 40px;
            background: #fafbfc;
        }

        .section-title {
            font-size: 2em;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .packing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .packing-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .packing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(102,126,234,0.2);
        }

        .packing-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .packing-icon {
            font-size: 1.8em;
        }

        .packing-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #1e293b;
        }

        .packing-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .packing-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .packing-item:hover {
            background: #f0f4ff;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #667eea;
            border-radius: 6px;
            cursor: pointer;
        }

        /* Zoom Overlay */
        .zoom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
        }

        .zoom-overlay.active {
            display: flex;
        }

        .zoom-overlay img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 16px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            color: white;
        }

        .spinner {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 25px;
            font-size: 1.3em;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 25px;
            }

            .header-title h1 {
                font-size: 1.6em;
            }

            .header-top {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .stats-section, .main-content, .packing-section {
                padding: 25px;
            }

            .day-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .place-header-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .place-time {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text">Loading Your Trip Dashboard...</div>
    </div>

    <div class="zoom-overlay" id="zoomOverlay">
        <img id="zoomedImage" src="" alt="Zoomed">
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-top">
                    <div class="header-title">
                        <span style="font-size: 1.5em;">‚úàÔ∏è</span>
                        <h1 id="tripTitle">Travel Dashboard</h1>
                    </div>
                    <div class="header-badges" id="headerBadges"></div>
                </div>
                <div class="trip-overview" id="tripOverview"></div>
            </div>
        </div>

        <!-- Stats Section -->
        <div class="stats-section">
            <div class="stats-grid" id="statsGrid"></div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="content-grid">
                <!-- Sidebar -->
                <div class="sidebar">
                    <!-- Flight Panel -->
                    <div class="panel" id="flightPanel"></div>
                    
                    <!-- Hotel Panel -->
                    <div class="panel" id="hotelPanel"></div>
                    
                    <!-- Budget Panel -->
                    <div class="panel" id="budgetPanel"></div>
                </div>

                <!-- Itinerary -->
                <div>
                    <div class="panel">
                        <div class="panel-header">
                            <h2 class="panel-title">üìÖ Daily Itinerary</h2>
                        </div>
                        <div class="itinerary-container" id="itineraryContainer"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Packing Section -->
        <div class="packing-section">
            <h2 class="section-title">üéí Packing List & Checklist</h2>
            <div class="packing-grid" id="packingGrid"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let tripData = null;
        let currency = 'USD';
        const currencySymbols = {
            'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'INR': '‚Çπ', 'JPY': '¬•',
            'AUD': 'A$', 'CAD': 'C$', 'CHF': 'Fr', 'CNY': '¬•'
        };

        function safeGet(obj, path, defaultValue = '') {
            try {
                const value = path.split('.').reduce((acc, part) => acc && acc[part], obj);
                return value !== undefined && value !== null ? value : defaultValue;
            } catch {
                return defaultValue;
            }
        }

        function zoomImage(imgSrc) {
            const overlay = document.getElementById('zoomOverlay');
            const zoomedImg = document.getElementById('zoomedImage');
            zoomedImg.src = imgSrc;
            overlay.classList.add('active');
        }

        document.getElementById('zoomOverlay').addEventListener('click', function() {
            this.classList.remove('active');
        });

        async function loadItinerary() {
            const userId = new URLSearchParams(window.location.search).get('user') || 'default';
            const jsonUrl = `https://raw.githubusercontent.com/l0keshai0004-beep/jsons/refs/heads/main/${userId}.json`;
            
            try {
                const res = await fetch(jsonUrl);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const data = await res.json();
                tripData = data;
                
                const currencyCode = safeGet(data, 'tripOverview.currency', 'USD');
                currency = currencySymbols[currencyCode] || currencyCode;
                
                renderDashboard(data);
            } catch (err) {
                console.error('Error:', err);
                document.getElementById('loadingScreen').innerHTML = `
                    <div style="text-align: center; color: white;">
                        <h2>‚ö†Ô∏è Failed to Load Itinerary</h2>
                        <p style="margin-top: 15px;">${err.message}</p>
                    </div>
                `;
            }
        }

        function renderDashboard(data) {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';

            const destination = safeGet(data, 'tripOverview.destination', 'Trip');
            document.getElementById('tripTitle').textContent = destination;

            renderHeader(data);
            renderStats(data);
            renderFlightPanel(data);
            renderHotelPanel(data);
            renderBudgetPanel(data);
            renderItinerary(data);
            renderPacking(data);
        }

        function renderHeader(data) {
            const overview = safeGet(data, 'tripOverview', {});
            
            document.getElementById('headerBadges').innerHTML = `
                <div class="badge">üìÖ ${safeGet(overview, 'duration', 'N/A')}</div>
                <div class="badge">üë• ${safeGet(overview, 'companions', 'N/A')}</div>
            `;

            document.getElementById('tripOverview').innerHTML = `
                <div class="overview-card">
                    <div class="overview-label">Destination</div>
                    <div class="overview-value">${safeGet(overview, 'destination', 'N/A')}</div>
                </div>
                <div class="overview-card">
                    <div class="overview-label">Check-In</div>
                    <div class="overview-value">${safeGet(overview, 'startDate', 'N/A')}</div>
                </div>
                <div class="overview-card">
                    <div class="overview-label">Check-Out</div>
                    <div class="overview-value">${safeGet(overview, 'endDate', 'N/A')}</div>
                </div>
                <div class="overview-card">
                    <div class="overview-label">Trip Type</div>
                    <div class="overview-value" style="font-size: 1em;">${safeGet(overview, 'tripType', 'N/A')}</div>
                </div>
            `;
        }

        function renderStats(data) {
            const budget = safeGet(data, 'budgetBreakdown', {});
            const itinerary = safeGet(data, 'dailyItinerary', []);
            const totalPlaces = itinerary.reduce((sum, day) => sum + safeGet(day, 'places', []).length, 0);
            
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <span class="stat-icon">üìç</span>
                    <div class="stat-value">${totalPlaces}</div>
                    <div class="stat-label">Places to Visit</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üìÖ</span>
                    <div class="stat-value">${itinerary.length}</div>
                    <div class="stat-label">Days of Adventure</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üí∞</span>
                    <div class="stat-value">${safeGet(budget, 'totalBudget', 'N/A')}</div>
                    <div class="stat-label">Total Budget</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üè®</span>
                    <div class="stat-value">${safeGet(data, 'hotel.rating', 'N/A')}‚≠ê</div>
                    <div class="stat-label">Hotel Rating</div>
                </div>
            `;
        }

        function renderFlightPanel(data) {
            const flight = safeGet(data, 'mode_of_transport.flight', {});
            
            document.getElementById('flightPanel').innerHTML = `
                <div class="panel-header">
                    <h2 class="panel-title">‚úàÔ∏è Flight Details</h2>
                    <span class="panel-badge">Booked</span>
                </div>
                <div class="flight-route">
                    <div class="airport">
                        <div class="airport-code">DEL</div>
                        <div class="airport-name">Delhi</div>
                    </div>
                    <div class="flight-arrow">‚Üí</div>
                    <div class="airport">
                        <div class="airport-code">LHR</div>
                        <div class="airport-name">London</div>
                    </div>
                </div>
                <div class="flight-details">
                    <div class="detail-box">
                        <div class="detail-label">Cost</div>
                        <div class="detail-value">${safeGet(flight, 'Approx_cost', 'N/A')}</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Duration</div>
                        <div class="detail-value">${safeGet(flight, 'Approx_time_of_flight(duration)', 'N/A')}</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Stops</div>
                        <div class="detail-value">${safeGet(flight, 'Stops', 'N/A').includes('Direct') ? 'Direct' : '1+ Stop'}</div>
                    </div>
                    <div class="detail-box">
                        <div class="detail-label">Class</div>
                        <div class="detail-value">Economy</div>
                    </div>
                </div>
            `;
        }

        function renderHotelPanel(data) {
            const hotel = safeGet(data, 'hotel', {});
            const thumbnails = safeGet(hotel, 'thumbnails', []);
            const amenities = safeGet(hotel, 'amenities', []).slice(0, 6);
            
            const imageHTML = thumbnails[0] ? `
                <div class="hotel-image-wrapper" onclick="zoomImage('${thumbnails[0]}')">
                    <img src="${thumbnails[0]}" class="hotel-image" alt="${safeGet(hotel, 'name', 'Hotel')}">
                    <div class="zoom-indicator">üîç</div>
                </div>
            ` : '';
            
            document.getElementById('hotelPanel').innerHTML = `
                <div class="panel-header">
                    <h2 class="panel-title">üè® Hotel</h2>
                    <span class="panel-badge">${safeGet(hotel, 'rating', 'N/A')}‚≠ê</span>
                </div>
                <div class="hotel-showcase">
                    ${imageHTML}
                    <div class="hotel-details">
                        <div class="hotel-name">${safeGet(hotel, 'name', 'Hotel')}</div>
                        <div class="hotel-rating">
                            <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            <span class="reviews">${safeGet(hotel, 'reviews', '0')} reviews</span>
                        </div>
                        <div class="hotel-price">${safeGet(hotel, 'pricePerNight', 'N/A')}<span>/night</span></div>
                        ${hotel.bookingLink ? `<a href="${hotel.bookingLink}" target="_blank" class="btn btn-primary">Book Now</a>` : ''}
                    </div>
                </div>
                <div class="amenities-grid">
                    ${amenities.map(a => `<div class="amenity"><span class="amenity-icon">‚úì</span>${a}</div>`).join('')}
                </div>
            `;
        }

        function renderBudgetPanel(data) {
            const budget = safeGet(data, 'budgetBreakdown', {});
            const expenses = safeGet(budget, 'expenses', {});
            
            document.getElementById('budgetPanel').innerHTML = `
                <div class="panel-header">
                    <h2 class="panel-title">üí∞ Budget Overview</h2>
                </div>
                <div class="budget-display">
                    <div class="budget-total">${safeGet(budget, 'totalBudget', 'N/A')}</div>
                    <div class="budget-subtitle">Total Trip Budget</div>
                </div>
                <div class="budget-breakdown">
                    <div class="budget-row">
                        <div class="budget-row-left">
                            <div class="budget-color" style="background: #667eea;"></div>
                            <div class="budget-category">Flights</div>
                        </div>
                        <div class="budget-amount">${safeGet(expenses, 'Transport[0].total_cost', 'N/A')}</div>
                    </div>
                    <div class="budget-row">
                        <div class="budget-row-left">
                            <div class="budget-color" style="background: #764ba2;"></div>
                            <div class="budget-category">Accommodation</div>
                        </div>
                        <div class="budget-amount">${safeGet(expenses, 'accommodation.total', 'N/A')}</div>
                    </div>
                    <div class="budget-row">
                        <div class="budget-row-left">
                            <div class="budget-color" style="background: #10b981;"></div>
                            <div class="budget-category">Remaining</div>
                        </div>
                        <div class="budget-amount">${safeGet(budget, 'remainingBudget', 'N/A')}</div>
                    </div>
                </div>
            `;
        }

        function renderItinerary(data) {
            const itinerary = safeGet(data, 'dailyItinerary', []);
            const container = document.getElementById('itineraryContainer');
            
            itinerary.forEach((day, dayIdx) => {
                const places = safeGet(day, 'places', []);
                
                const dayEl = document.createElement('div');
                dayEl.className = 'day-accordion';
                dayEl.innerHTML = `
                    <div class="day-header" onclick="toggleDay(${dayIdx})">
                        <div class="day-left">
                            <div class="day-number-badge">${safeGet(day, 'day', dayIdx + 1)}</div>
                            <div class="day-info">
                                <h3>${safeGet(day, 'theme', 'Exploration')}</h3>
                                <div class="day-info-meta">
                                    <span>üìÖ ${safeGet(day, 'date', 'N/A')}</span>
                                    <span>üö∂ ${safeGet(day, 'totalDistance', 'N/A')} km</span>
                                    <span>‚è±Ô∏è ${safeGet(day, 'totalTravelTime', 'N/A')}</span>
                                </div>
                            </div>
                        </div>
                        <div class="day-expand" id="day-expand-${dayIdx}">‚ñº</div>
                    </div>
                    <div class="day-content" id="day-content-${dayIdx}">
                        <div class="day-body">
                            ${day.weather ? `
                                <div class="weather-card">
                                    <span class="weather-icon">üå§Ô∏è</span>
                                    <div>
                                        <strong>Weather Forecast</strong><br>
                                        ${day.weather}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="map-container" id="map-${dayIdx}"></div>
                            
                            <h4 style="margin: 25px 0 15px; color: #1e293b; font-size: 1.3em;">üìç Places to Visit</h4>
                            <div class="places-list">
                                ${renderPlaces(places, dayIdx)}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(dayEl);

                // Init map
                setTimeout(() => {
                    if (places.length > 0) {
                        const coords = safeGet(places[0], 'coordinates', {});
                        const lat = safeGet(coords, 'latitude', 51.5074);
                        const lng = safeGet(coords, 'longitude', -0.1278);
                        
                        if (lat && lng) {
                            const map = L.map(`map-${dayIdx}`).setView([lat, lng], 13);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
                            
                            places.forEach((place, pIdx) => {
                                const pCoords = safeGet(place, 'coordinates', {});
                                const pLat = safeGet(pCoords, 'latitude');
                                const pLng = safeGet(pCoords, 'longitude');
                                
                                if (pLat && pLng) {
                                    L.marker([pLat, pLng])
                                        .addTo(map)
                                        .bindPopup(`<b>${pIdx + 1}. ${safeGet(place, 'name', 'Location')}</b>`);
                                }
                            });
                        }
                    }
                }, 200 + (dayIdx * 100));
            });
        }

        function renderPlaces(places, dayIdx) {
            return places.map((place, pIdx) => {
                const activities = safeGet(place, 'activities', []);
                const practicalInfo = safeGet(place, 'practicalInfo', {});
                const tips = safeGet(place, 'tips', {});
                
                return `
                    <div class="place-item">
                        <div class="place-header" onclick="togglePlace(${dayIdx}, ${pIdx})">
                            <div class="place-header-left">
                                <div class="place-number-badge">${pIdx + 1}</div>
                                <div class="place-info">
                                    <div class="place-name">${safeGet(place, 'name', 'Location')}</div>
                                    ${place.whyVisit ? `<div class="place-why">${place.whyVisit}</div>` : ''}
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="place-time">${safeGet(place, 'timeOfDay', 'N/A')}</div>
                                <div class="place-expand" id="place-expand-${dayIdx}-${pIdx}">‚ñº</div>
                            </div>
                        </div>
                        <div class="place-content" id="place-content-${dayIdx}-${pIdx}">
                            <div class="place-body">
                                <p class="place-description">${safeGet(place, 'description', '')}</p>
                                
                                ${activities.length > 0 ? `
                                    <div class="activities-box">
                                        <h5>‚ú® Activities</h5>
                                        <ul>
                                            ${activities.map(a => `<li>${a}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                
                                <div class="place-stats">
                                    <div class="stat-box">
                                        <div class="stat-box-label">Entry Fee</div>
                                        <div class="stat-box-value">${safeGet(practicalInfo, 'entryFee', 'N/A')}</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-box-label">Duration</div>
                                        <div class="stat-box-value">${safeGet(practicalInfo, 'duration', 'N/A')}</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-box-label">Cost</div>
                                        <div class="stat-box-value">${safeGet(practicalInfo, 'estimatedCost', 'N/A')}</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-box-label">Travel Time</div>
                                        <div class="stat-box-value">${safeGet(place, 'travelTimeFromPrevious', 'N/A')}</div>
                                    </div>
                                </div>
                                
                                ${(tips.whatToBring && tips.whatToBring.length > 0) || (tips.safetyNotes && tips.safetyNotes.length > 0) ? `
                                    <div class="tips-card">
                                        <h5>üí° Helpful Tips</h5>
                                        ${tips.whatToBring && tips.whatToBring.length > 0 ? `<p><strong>What to Bring:</strong> ${tips.whatToBring.join(', ')}</p>` : ''}
                                        ${tips.safetyNotes && tips.safetyNotes.length > 0 ? `<p><strong>Safety Notes:</strong> ${tips.safetyNotes.join('; ')}</p>` : ''}
                                    </div>
                                ` : ''}
                                
                                <div class="place-actions">
                                    ${place.googlemapintegrationlink ? `<a href="${place.googlemapintegrationlink}" target="_blank" class="btn btn-primary">üìç View on Google Maps</a>` : ''}
                                    ${place.addtocalendar ? `<a href="${place.addtocalendar}" target="_blank" class="btn btn-secondary">üìÖ Add to Calendar</a>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleDay(idx) {
            const content = document.getElementById(`day-content-${idx}`);
            const icon = document.getElementById(`day-expand-${idx}`);
            content.classList.toggle('active');
            icon.classList.toggle('active');
        }

        function togglePlace(dayIdx, placeIdx) {
            const content = document.getElementById(`place-content-${dayIdx}-${placeIdx}`);
            const icon = document.getElementById(`place-expand-${dayIdx}-${placeIdx}`);
            content.classList.toggle('active');
            icon.classList.toggle('active');
        }

        function renderPacking(data) {
            const packing = safeGet(data, 'packingList', {});
            const checklist = safeGet(data, 'preTripChecklist', {});
            const container = document.getElementById('packingGrid');
            
            Object.entries(packing).forEach(([category, items]) => {
                if (Array.isArray(items) && items.length > 0) {
                    const card = document.createElement('div');
                    card.className = 'packing-card';
                    card.innerHTML = `
                        <div class="packing-header">
                            <span class="packing-icon">üéí</span>
                            <h4 class="packing-title">${category.charAt(0).toUpperCase() + category.slice(1).replace(/([A-Z])/g, ' $1')}</h4>
                        </div>
                        <div class="packing-items">
                            ${items.slice(0, 8).map(item => `
                                <div class="packing-item">
                                    <div class="checkbox"></div>
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(card);
                }
            });

            const priorities = {
                highPriority: { icon: 'üî¥', name: 'High Priority' },
                mediumPriority: { icon: 'üü°', name: 'Medium Priority' },
                lowPriority: { icon: 'üü¢', name: 'Low Priority' }
            };

            Object.entries(priorities).forEach(([key, config]) => {
                const items = safeGet(checklist, key, []);
                if (items.length > 0) {
                    const card = document.createElement('div');
                    card.className = 'packing-card';
                    card.innerHTML = `
                        <div class="packing-header">
                            <span class="packing-icon">${config.icon}</span>
                            <h4 class="packing-title">${config.name}</h4>
                        </div>
                        <div class="packing-items">
                            ${items.slice(0, 6).map(item => `
                                <div class="packing-item">
                                    <div class="checkbox"></div>
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(card);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', loadItinerary);
    </script>
</body>
</html>
