<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Top Navigation Bar */
        .top-nav {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-brand h1 {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .info-badge {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .info-label {
            font-size: 0.75em;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 1em;
            font-weight: 600;
            color: #f1f5f9;
        }

        /* Hero Stats Section */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(96,165,250,0.3);
            border-color: rgba(96,165,250,0.5);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, rgba(96,165,250,0.2) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            display: block;
        }

        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Main Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Sidebar Panels */
        .sidebar-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .panel-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-badge {
            background: rgba(96,165,250,0.2);
            color: #60a5fa;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        /* Flight Card */
        .flight-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .flight-route {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(96,165,250,0.1);
            padding: 15px;
            border-radius: 12px;
        }

        .airport {
            text-align: center;
        }

        .airport-code {
            font-size: 1.5em;
            font-weight: 700;
            color: #60a5fa;
        }

        .airport-name {
            font-size: 0.75em;
            color: #94a3b8;
            margin-top: 5px;
        }

        .flight-arrow {
            font-size: 2em;
            color: #60a5fa;
        }

        .flight-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .detail-item {
            background: rgba(255,255,255,0.05);
            padding: 12px;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.75em;
            color: #94a3b8;
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 1em;
            font-weight: 600;
            color: #f1f5f9;
        }

        /* Hotel Card */
        .hotel-preview {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .hotel-image {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            object-fit: cover;
        }

        .hotel-info {
            flex: 1;
        }

        .hotel-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 8px;
        }

        .hotel-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .stars {
            color: #fbbf24;
            font-size: 1.1em;
        }

        .rating-text {
            font-size: 0.9em;
            color: #94a3b8;
        }

        .hotel-price {
            font-size: 1.3em;
            font-weight: 700;
            color: #60a5fa;
        }

        .amenities-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .amenity-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85em;
            color: #cbd5e1;
        }

        .amenity-icon {
            color: #60a5fa;
        }

        /* Budget Panel */
        .budget-overview {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .budget-circle {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
        }

        .budget-amount {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .total-budget {
            font-size: 2em;
            font-weight: 700;
            color: #60a5fa;
        }

        .budget-label {
            font-size: 0.8em;
            color: #94a3b8;
        }

        .budget-breakdown {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        .budget-item-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: #cbd5e1;
        }

        .budget-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .budget-item-value {
            font-weight: 600;
            color: #f1f5f9;
        }

        /* Itinerary Timeline */
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .day-card {
            background: rgba(30,41,59,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .day-card:hover {
            border-color: rgba(96,165,250,0.5);
            box-shadow: 0 8px 25px rgba(96,165,250,0.2);
        }

        .day-header {
            background: linear-gradient(135deg, #3b4a6b 0%, #1e293b 100%);
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .day-header:hover {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
        }

        .day-header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .day-number {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: 700;
        }

        .day-info h3 {
            font-size: 1.2em;
            color: #f1f5f9;
            margin-bottom: 5px;
        }

        .day-meta {
            display: flex;
            gap: 15px;
            font-size: 0.85em;
            color: #94a3b8;
        }

        .day-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .expand-icon {
            font-size: 1.5em;
            color: #60a5fa;
            transition: transform 0.3s ease;
        }

        .expand-icon.active {
            transform: rotate(180deg);
        }

        .day-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .day-content.active {
            max-height: 5000px;
        }

        .day-body {
            padding: 25px;
        }

        .weather-banner {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weather-icon {
            font-size: 2em;
        }

        .weather-text {
            flex: 1;
            color: white;
        }

        .map-embed {
            width: 100%;
            height: 350px;
            border-radius: 12px;
            margin: 20px 0;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .places-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .place-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .place-card:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(96,165,250,0.5);
            transform: translateX(5px);
        }

        .place-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .place-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 5px;
        }

        .place-subtitle {
            font-size: 0.85em;
            color: #60a5fa;
            font-style: italic;
        }

        .time-badge {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .place-description {
            color: #cbd5e1;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .activities-section {
            background: rgba(96,165,250,0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .activities-section h5 {
            color: #60a5fa;
            margin-bottom: 10px;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .activities-section ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .activities-section li {
            display: flex;
            align-items: start;
            gap: 10px;
            color: #cbd5e1;
            font-size: 0.9em;
        }

        .activities-section li::before {
            content: "‚Üí";
            color: #60a5fa;
            font-weight: bold;
        }

        .place-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .place-stat {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .place-stat-label {
            font-size: 0.75em;
            color: #94a3b8;
            margin-bottom: 5px;
        }

        .place-stat-value {
            font-size: 0.95em;
            font-weight: 600;
            color: #f1f5f9;
        }

        .place-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(96,165,250,0.4);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #cbd5e1;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        /* Packing & Checklist */
        .checklist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .checklist-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
        }

        .checklist-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .checklist-icon {
            font-size: 1.5em;
        }

        .checklist-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #f1f5f9;
        }

        .checklist-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            font-size: 0.9em;
            color: #cbd5e1;
            transition: all 0.2s ease;
        }

        .checklist-item:hover {
            background: rgba(255,255,255,0.08);
        }

        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid #60a5fa;
            border-radius: 4px;
            cursor: pointer;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(96,165,250,0.2);
            border-top-color: #60a5fa;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 1.2em;
            color: #94a3b8;
        }

        .error-screen {
            padding: 40px;
            text-align: center;
            color: #f87171;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .nav-info {
                flex-direction: column;
                align-items: flex-end;
                gap: 10px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 10px;
            }

            .top-nav {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .nav-info {
                align-items: center;
            }

            .hero-stats {
                grid-template-columns: 1fr;
            }

            .day-header-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading your travel dashboard...</div>
    </div>

    <div class="dashboard-container" id="dashboardContainer" style="display: none;">
        <!-- Top Navigation -->
        <div class="top-nav">
            <div class="nav-brand">
                <span style="font-size: 2em;">‚úàÔ∏è</span>
                <h1 id="tripTitle">Travel Dashboard</h1>
            </div>
            <div class="nav-info" id="navInfo"></div>
        </div>

        <!-- Hero Stats -->
        <div class="hero-stats" id="heroStats"></div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Sidebar -->
            <div class="sidebar-panel">
                <!-- Flight Panel -->
                <div class="panel" id="flightPanel"></div>
                
                <!-- Hotel Panel -->
                <div class="panel" id="hotelPanel"></div>
                
                <!-- Budget Panel -->
                <div class="panel" id="budgetPanel"></div>
            </div>

            <!-- Main Content -->
            <div class="main-panel">
                <!-- Daily Itinerary -->
                <div class="panel">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            üìÖ Daily Itinerary
                        </h2>
                    </div>
                    <div class="timeline" id="itineraryTimeline"></div>
                </div>
            </div>
        </div>

        <!-- Packing & Checklist Section -->
        <div class="panel">
            <div class="panel-header">
                <h2 class="panel-title">üéí Packing List & Checklist</h2>
            </div>
            <div class="checklist-grid" id="packingChecklist"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let tripData = null;
        let currency = 'USD';
        const currencySymbols = {
            'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'INR': '‚Çπ', 'JPY': '¬•',
            'AUD': 'A$', 'CAD': 'C$', 'CHF': 'Fr', 'CNY': '¬•'
        };

        function safeGet(obj, path, defaultValue = '') {
            try {
                const value = path.split('.').reduce((acc, part) => acc && acc[part], obj);
                return value !== undefined && value !== null ? value : defaultValue;
            } catch {
                return defaultValue;
            }
        }

        async function loadItinerary() {
            const userId = new URLSearchParams(window.location.search).get('user') || 'default';
            const jsonUrl = `https://raw.githubusercontent.com/l0keshai0004-beep/jsons/refs/heads/main/${userId}.json`;
            
            try {
                const res = await fetch(jsonUrl);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const data = await res.json();
                tripData = data;
                
                const currencyCode = safeGet(data, 'tripOverview.currency', 'USD');
                currency = currencySymbols[currencyCode] || currencyCode;
                
                renderDashboard(data);
            } catch (err) {
                console.error('Error:', err);
                document.getElementById('loadingScreen').innerHTML = `
                    <div class="error-screen">
                        <h2>‚ö†Ô∏è Failed to load itinerary</h2>
                        <p>${err.message}</p>
                        <p style="margin-top: 20px;">Check the user parameter in URL</p>
                    </div>
                `;
            }
        }

        function renderDashboard(data) {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('dashboardContainer').style.display = 'block';

            const destination = safeGet(data, 'tripOverview.destination', 'Trip');
            document.getElementById('tripTitle').textContent = destination;

            renderNavInfo(data);
            renderHeroStats(data);
            renderFlightPanel(data);
            renderHotelPanel(data);
            renderBudgetPanel(data);
            renderItinerary(data);
            renderPackingChecklist(data);
        }

        function renderNavInfo(data) {
            const overview = safeGet(data, 'tripOverview', {});
            document.getElementById('navInfo').innerHTML = `
                <div class="info-badge">
                    <span class="info-label">Dates</span>
                    <span class="info-value">${safeGet(overview, 'startDate', 'N/A')} - ${safeGet(overview, 'endDate', 'N/A')}</span>
                </div>
                <div class="info-badge">
                    <span class="info-label">Travelers</span>
                    <span class="info-value">${safeGet(overview, 'companions', 'N/A')}</span>
                </div>
            `;
        }

        function renderHeroStats(data) {
            const overview = safeGet(data, 'tripOverview', {});
            const budget = safeGet(data, 'budgetBreakdown', {});
            const itinerary = safeGet(data, 'dailyItinerary', []);
            
            const totalPlaces = itinerary.reduce((sum, day) => sum + safeGet(day, 'places', []).length, 0);
            
            document.getElementById('heroStats').innerHTML = `
                <div class="stat-card">
                    <span class="stat-icon">üìÖ</span>
                    <div class="stat-value">${safeGet(overview, 'duration', 'N/A')}</div>
                    <div class="stat-label">Duration</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üìç</span>
                    <div class="stat-value">${totalPlaces}</div>
                    <div class="stat-label">Places to Visit</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üí∞</span>
                    <div class="stat-value">${safeGet(budget, 'totalBudget', 'N/A')}</div>
                    <div class="stat-label">Total Budget</div>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üè®</span>
                    <div class="stat-value">${safeGet(data, 'hotel.rating', 'N/A')}‚≠ê</div>
                    <div class="stat-label">Hotel Rating</div>
                </div>
            `;
        }

        function renderFlightPanel(data) {
            const flight = safeGet(data, 'mode_of_transport.flight', {});
            document.getElementById('flightPanel').innerHTML = `
                <div class="panel-header">
                    <h2 class="panel-title">‚úàÔ∏è Flight</h2>
                    <span class="panel-badge">Upcoming</span>
                </div>
                <div class="flight-info">
                    <div class="flight-route">
                        <div class="airport">
                            <div class="airport-code">DEL</div>
                            <div class="airport-name">Delhi</div>
                        </div>
                        <div class="flight-arrow">‚Üí</div>
                        <div class="airport">
                            <div class="airport-code">LHR</div>
                            <div class="airport-name">London</div>
                        </div>
                    </div>
                    <div class="flight-details">
                        <div class="detail-item">
                            <div class="detail-label">Cost</div>
                            <div class="detail-value">${safeGet(flight, 'Approx_cost', 'N/A')}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Duration</div>
                            <div class="detail-value">${safeGet(flight, 'Approx_time_of_flight(duration)', 'N/A')}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Stops</div>
                            <div class="detail-value">${safeGet(flight, 'Stops', 'N/A').includes('Direct') ? 'Direct' : '1+ Stop'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Class</div>
                            <div class="detail-value">Economy</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHotelPanel(data) {
            const hotel = safeGet(data, 'hotel', {});
            const thumbnails = safeGet(hotel, 'thumbnails', []);
            const amenities = safeGet(hotel, 'amenities', []).slice(0, 6);
            
            document.getElementById('hotelPanel').innerHTML = `
                <div class="panel-header">
                    <h2 class="panel-title">üè® Hotel</h2>
                    <span class="panel-badge">${safeGet(hotel, 'rating', 'N/A')}‚≠ê</span>
                </div>
                <div class="hotel-preview">
                    ${thumbnails[0] ? `<img src="${thumbnails[0]}" class="hotel-image" alt="${safeGet(hotel, 'name', 'Hotel')}">` : ''}
                    <div class="hotel-info">
                        <div class="hotel-name">${safeGet(hotel, 'name', 'Hotel')}</div>
                        <div class="hotel-rating">
                            <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                            <span class="rating-text">${safeGet(hotel, 'reviews', '0')} reviews</span>
                        </div>
                        <div class="hotel-price">${safeGet(hotel, 'pricePerNight', 'N/A')}/night</div>
                        <div style="margin-top: 10px;">
                            ${hotel.bookingLink ? `<a href="${hotel.bookingLink}" target="_blank" class="btn btn-primary">Book Now</a>` : ''}
                        </div>
                    </div>
                </div>
                <div class="amenities-grid">
                    ${amenities.map(a => `<div class="amenity-item"><span class="amenity-icon">‚úì</span> ${a}</div>`).join('')}
                </div>
            `;
        }

        function renderBudgetPanel(data) {
            const budget = safeGet(data, 'budgetBreakdown', {});
            const expenses = safeGet(budget, 'expenses', {});
            
            document.getElementById('budgetPanel').innerHTML = `
                <div class="panel-header">
                    <h2 class="panel-title">üí∞ Budget</h2>
                </div>
                <div class="budget-overview">
                    <div class="budget-amount">
                        <div class="total-budget">${safeGet(budget, 'totalBudget', 'N/A')}</div>
                        <div class="budget-label">Total Budget</div>
                    </div>
                    <div class="budget-breakdown">
                        <div class="budget-item">
                            <span class="budget-item-label">
                                <span class="budget-dot" style="background: #60a5fa;"></span>
                                Flights
                            </span>
                            <span class="budget-item-value">${safeGet(expenses, 'Transport[0].total_cost', 'N/A')}</span>
                        </div>
                        <div class="budget-item">
                            <span class="budget-item-label">
                                <span class="budget-dot" style="background: #a78bfa;"></span>
                                Accommodation
                            </span>
                            <span class="budget-item-value">${safeGet(expenses, 'accommodation.total', 'N/A')}</span>
                        </div>
                        <div class="budget-item">
                            <span class="budget-item-label">
                                <span class="budget-dot" style="background: #f59e0b;"></span>
                                Remaining
                            </span>
                            <span class="budget-item-value">${safeGet(budget, 'remainingBudget', 'N/A')}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderItinerary(data) {
            const itinerary = safeGet(data, 'dailyItinerary', []);
            const container = document.getElementById('itineraryTimeline');
            
            itinerary.forEach((day, index) => {
                const places = safeGet(day, 'places', []);
                
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                dayCard.innerHTML = `
                    <div class="day-header" onclick="toggleDay(${index})">
                        <div class="day-header-left">
                            <div class="day-number">${safeGet(day, 'day', index + 1)}</div>
                            <div class="day-info">
                                <h3>${safeGet(day, 'theme', 'Exploration')}</h3>
                                <div class="day-meta">
                                    <span>üìÖ ${safeGet(day, 'date', 'N/A')}</span>
                                    <span>üö∂ ${safeGet(day, 'totalDistance', 'N/A')} km</span>
                                    <span>‚è±Ô∏è ${safeGet(day, 'totalTravelTime', 'N/A')}</span>
                                </div>
                            </div>
                        </div>
                        <div class="expand-icon" id="expand-${index}">‚ñº</div>
                    </div>
                    <div class="day-content" id="day-content-${index}">
                        <div class="day-body">
                            ${day.weather ? `
                                <div class="weather-banner">
                                    <span class="weather-icon">üå§Ô∏è</span>
                                    <div class="weather-text">
                                        <strong>Weather Forecast</strong><br>
                                        ${day.weather}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="map-embed" id="map-${index}"></div>
                            
                            <div class="places-grid">
                                ${renderPlaces(places)}
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(dayCard);

                // Initialize map
                setTimeout(() => {
                    if (places.length > 0) {
                        const firstPlace = places[0];
                        const coords = safeGet(firstPlace, 'coordinates', {});
                        const lat = safeGet(coords, 'latitude', 51.5074);
                        const lng = safeGet(coords, 'longitude', -0.1278);
                        
                        if (lat && lng) {
                            const map = L.map(`map-${index}`).setView([lat, lng], 13);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '¬© OpenStreetMap'
                            }).addTo(map);
                            
                            places.forEach((place, pIndex) => {
                                const pCoords = safeGet(place, 'coordinates', {});
                                const pLat = safeGet(pCoords, 'latitude');
                                const pLng = safeGet(pCoords, 'longitude');
                                
                                if (pLat && pLng) {
                                    L.marker([pLat, pLng])
                                        .addTo(map)
                                        .bindPopup(`<b>${pIndex + 1}. ${safeGet(place, 'name', 'Location')}</b>`);
                                }
                            });
                        }
                    }
                }, 200 + (index * 100));
            });
        }

        function renderPlaces(places) {
            return places.map(place => {
                const activities = safeGet(place, 'activities', []);
                const practicalInfo = safeGet(place, 'practicalInfo', {});
                
                return `
                    <div class="place-card">
                        <div class="place-header">
                            <div>
                                <div class="place-title">${safeGet(place, 'name', 'Location')}</div>
                                ${place.whyVisit ? `<div class="place-subtitle">${place.whyVisit}</div>` : ''}
                            </div>
                            <div class="time-badge">${safeGet(place, 'timeOfDay', 'N/A')}</div>
                        </div>
                        
                        <p class="place-description">${safeGet(place, 'description', '')}</p>
                        
                        ${activities.length > 0 ? `
                            <div class="activities-section">
                                <h5>Activities</h5>
                                <ul>
                                    ${activities.map(a => `<li>${a}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        <div class="place-stats">
                            <div class="place-stat">
                                <div class="place-stat-label">Entry Fee</div>
                                <div class="place-stat-value">${safeGet(practicalInfo, 'entryFee', 'N/A')}</div>
                            </div>
                            <div class="place-stat">
                                <div class="place-stat-label">Duration</div>
                                <div class="place-stat-value">${safeGet(practicalInfo, 'duration', 'N/A')}</div>
                            </div>
                            <div class="place-stat">
                                <div class="place-stat-label">Cost</div>
                                <div class="place-stat-value">${safeGet(practicalInfo, 'estimatedCost', 'N/A')}</div>
                            </div>
                            <div class="place-stat">
                                <div class="place-stat-label">Travel Time</div>
                                <div class="place-stat-value">${safeGet(place, 'travelTimeFromPrevious', 'N/A')}</div>
                            </div>
                        </div>
                        
                        <div class="place-actions">
                            ${place.googlemapintegrationlink ? `<a href="${place.googlemapintegrationlink}" target="_blank" class="btn btn-primary">üìç View Map</a>` : ''}
                            ${place.addtocalendar ? `<a href="${place.addtocalendar}" target="_blank" class="btn btn-secondary">üìÖ Calendar</a>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPackingChecklist(data) {
            const packing = safeGet(data, 'packingList', {});
            const checklist = safeGet(data, 'preTripChecklist', {});
            const container = document.getElementById('packingChecklist');
            
            // Render packing categories
            Object.entries(packing).forEach(([category, items]) => {
                if (Array.isArray(items) && items.length > 0) {
                    const categoryCard = document.createElement('div');
                    categoryCard.className = 'checklist-card';
                    categoryCard.innerHTML = `
                        <div class="checklist-header">
                            <span class="checklist-icon">üéí</span>
                            <h4 class="checklist-title">${category.charAt(0).toUpperCase() + category.slice(1).replace(/([A-Z])/g, ' $1')}</h4>
                        </div>
                        <div class="checklist-items">
                            ${items.slice(0, 8).map(item => `
                                <div class="checklist-item">
                                    <div class="checkbox"></div>
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(categoryCard);
                }
            });

            // Render priority checklist
            const priorities = {
                highPriority: { icon: 'üî¥', name: 'High Priority' },
                mediumPriority: { icon: 'üü°', name: 'Medium Priority' },
                lowPriority: { icon: 'üü¢', name: 'Low Priority' }
            };

            Object.entries(priorities).forEach(([key, config]) => {
                const items = safeGet(checklist, key, []);
                if (items.length > 0) {
                    const card = document.createElement('div');
                    card.className = 'checklist-card';
                    card.innerHTML = `
                        <div class="checklist-header">
                            <span class="checklist-icon">${config.icon}</span>
                            <h4 class="checklist-title">${config.name}</h4>
                        </div>
                        <div class="checklist-items">
                            ${items.slice(0, 6).map(item => `
                                <div class="checklist-item">
                                    <div class="checkbox"></div>
                                    ${item}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    container.appendChild(card);
                }
            });
        }

        function toggleDay(index) {
            const content = document.getElementById(`day-content-${index}`);
            const icon = document.getElementById(`expand-${index}`);
            
            content.classList.toggle('active');
            icon.classList.toggle('active');
        }

        document.addEventListener('DOMContentLoaded', loadItinerary);
    </script>
</body>
</html>
