<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Planner</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .trip-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px 0;
        }

        .overview-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .overview-item strong {
            display: block;
            font-size: 0.9em;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 2em;
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .hotel-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .hotel-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .hotel-info h3 {
            font-size: 1.8em;
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .rating {
            color: #f39c12;
            font-size: 1.2em;
        }

        .hotel-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .amenities {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .amenity-tag {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .hotel-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .hotel-images img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            transition: transform 0.3s;
        }

        .hotel-images img:hover {
            transform: scale(1.05);
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            font-size: 1em;
        }

        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .day-accordion {
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .day-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .day-header:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .day-header h3 {
            font-size: 1.5em;
        }

        .day-meta {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            flex-wrap: wrap;
        }

        .arrow {
            font-size: 1.5em;
            transition: transform 0.3s;
        }

        .arrow.active {
            transform: rotate(180deg);
        }

        .day-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            background: #f9f9f9;
        }

        .day-content.active {
            max-height: 5000px;
            transition: max-height 1s ease-in;
        }

        .day-details {
            padding: 30px;
        }

        .weather-info {
            background: linear-gradient(135deg, #56ccf2 0%, #2f80ed 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .place-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .place-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .place-title {
            font-size: 1.4em;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .time-badge {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            white-space: nowrap;
        }

        .place-description {
            color: #555;
            line-height: 1.6;
            margin: 15px 0;
        }

        .activities-list {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .activities-list ul {
            list-style-position: inside;
            color: #333;
        }

        .activities-list li {
            margin: 8px 0;
        }

        .practical-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: #e8f4f8;
            border-radius: 8px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-weight: bold;
            color: #1e3c72;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .budget-section {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .budget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .budget-item {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .budget-item h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .budget-amount {
            font-size: 2em;
            font-weight: bold;
        }

        .daily-spending {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .spending-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .spending-table th,
        .spending-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .spending-table th {
            background: #667eea;
            color: white;
        }

        .spending-table tr:hover {
            background: #f5f5f5;
        }

        .packing-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .packing-category {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 10px;
        }

        .packing-category h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .packing-category ul {
            list-style: none;
        }

        .packing-category li {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }

        .packing-category li::before {
            content: "‚úì";
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }

        .checklist {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .checklist h4 {
            color: #1e3c72;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .checklist ul {
            list-style: none;
        }

        .checklist li {
            padding: 10px;
            margin: 8px 0;
            background: #f9f9f9;
            border-left: 4px solid #667eea;
            border-radius: 5px;
        }

        .tips-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .tips-box h5 {
            color: #856404;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 100px 20px;
            font-size: 1.5em;
            color: #1e3c72;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 20px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .section-title {
                font-size: 1.5em;
            }
        }

        .day-summary {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .summary-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <h2>üåç Loading your trip itinerary...</h2>
        <p style="margin-top: 20px;">Please wait</p>
    </div>

    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <h1 id="headerTitle">Trip Planner</h1>
            <div class="trip-overview" id="tripOverview"></div>
        </div>

        <div class="content" id="mainContent"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let tripData = null;
        let currency = 'USD';
        const currencySymbols = {
            'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'INR': '‚Çπ', 'JPY': '¬•',
            'AUD': 'A$', 'CAD': 'C$', 'CHF': 'Fr', 'CNY': '¬•'
        };

        // Safe getter for nested properties
        function safeGet(obj, path, defaultValue = '') {
            try {
                const value = path.split('.').reduce((acc, part) => acc && acc[part], obj);
                return value !== undefined && value !== null ? value : defaultValue;
            } catch {
                return defaultValue;
            }
        }

        // Format currency
        function formatCurrency(value) {
            if (!value) return 'N/A';
            const numValue = typeof value === 'string' ? parseFloat(value.replace(/[^\d.]/g, '')) : value;
            return isNaN(numValue) ? value : `${currency}${numValue.toFixed(0)}`;
        }

        // Load itinerary from GitHub
        async function loadItinerary() {
            const userId = new URLSearchParams(window.location.search).get('user') || 'default';
            const jsonUrl = `https://raw.githubusercontent.com/l0keshai0004-beep/jsons/refs/heads/main/${userId}.json`;
            
            try {
                const res = await fetch(jsonUrl);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const data = await res.json();
                tripData = data;
                
                const currencyCode = safeGet(data, 'tripOverview.currency', 'USD');
                currency = currencySymbols[currencyCode] || currencyCode;
                
                renderContent(data);
            } catch (err) {
                console.error('Error:', err);
                document.getElementById('loading').innerHTML = `
                    <div class="error">
                        <h2>‚ö†Ô∏è Failed to load itinerary data</h2>
                        <p>Error: ${err.message}</p>
                        <p style="margin-top: 10px;">Please check the user parameter in the URL</p>
                    </div>
                `;
            }
        }

        // Render all content
        function renderContent(data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';

            // Set header title
            const destination = safeGet(data, 'tripOverview.destination', 'Trip');
            document.getElementById('headerTitle').textContent = `‚úàÔ∏è ${destination} Trip Planner`;

            // Render all sections
            renderTripOverview(data);
            renderFlightInfo(data);
            renderHotelInfo(data);
            renderDailyItinerary(data);
            renderBudget(data);
            renderPackingList(data);
            renderChecklist(data);
        }

        // Render trip overview
        function renderTripOverview(data) {
            const overview = safeGet(data, 'tripOverview', {});
            const container = document.getElementById('tripOverview');
            
            container.innerHTML = `
                <div class="overview-item">
                    <strong>Destination</strong>
                    <div>${safeGet(overview, 'destination', 'N/A')}</div>
                </div>
                <div class="overview-item">
                    <strong>Duration</strong>
                    <div>${safeGet(overview, 'duration', 'N/A')}</div>
                </div>
                <div class="overview-item">
                    <strong>Dates</strong>
                    <div>${safeGet(overview, 'startDate', 'N/A')} to ${safeGet(overview, 'endDate', 'N/A')}</div>
                </div>
                <div class="overview-item">
                    <strong>Travelers</strong>
                    <div>${safeGet(overview, 'companions', 'N/A')}</div>
                </div>
                <div class="overview-item">
                    <strong>Trip Type</strong>
                    <div>${safeGet(overview, 'tripType', 'N/A')}</div>
                </div>
            `;
        }

        // Render flight info
        function renderFlightInfo(data) {
            const flight = safeGet(data, 'mode_of_transport.flight', {});
            const html = `
                <div class="section">
                    <h2 class="section-title">‚úàÔ∏è Flight Information</h2>
                    <div class="hotel-card">
                        <h3>Flight Details</h3>
                        <div class="hotel-details">
                            <div>
                                <strong>Destination:</strong><br>${safeGet(flight, 'destination', 'N/A')}
                            </div>
                            <div>
                                <strong>Cost:</strong><br>${safeGet(flight, 'Approx_cost', 'N/A')}
                            </div>
                            <div>
                                <strong>Duration:</strong><br>${safeGet(flight, 'Approx_time_of_flight(duration)', 'N/A')}
                            </div>
                            <div>
                                <strong>From:</strong><br>${safeGet(flight, 'Nearest_airport_from_current_destination', 'N/A')}
                            </div>
                            <div>
                                <strong>To:</strong><br>${safeGet(flight, 'Nearest_airport_from_visiting_destination', 'N/A')}
                            </div>
                            <div>
                                <strong>Stops:</strong><br>${safeGet(flight, 'Stops', 'N/A')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('mainContent').insertAdjacentHTML('beforeend', html);
        }

        // Render hotel info
        function renderHotelInfo(data) {
            const hotel = safeGet(data, 'hotel', {});
            const thumbnails = safeGet(hotel, 'thumbnails', []);
            const amenities = safeGet(hotel, 'amenities', []);
            const coordinates = safeGet(hotel, 'coordinates', {});
            
            let imagesHTML = thumbnails.map(img => `<img src="${img}" alt="${safeGet(hotel, 'name', 'Hotel')}">`).join('');
            let amenitiesHTML = amenities.map(a => `<span class="amenity-tag">${a}</span>`).join('');
            
            const html = `
                <div class="section">
                    <h2 class="section-title">üè® Accommodation</h2>
                    <div class="hotel-card">
                        <div class="hotel-header">
                            <div class="hotel-info">
                                <h3>${safeGet(hotel, 'name', 'Hotel')}</h3>
                                <div class="rating">‚≠ê ${safeGet(hotel, 'rating', 'N/A')} (${safeGet(hotel, 'reviews', '0')} reviews)</div>
                                <p style="margin-top: 10px; color: #555;">${safeGet(hotel, 'description', '')}</p>
                            </div>
                            <div>
                                <div style="text-align: right; margin-bottom: 10px;">
                                    <strong style="font-size: 1.5em; color: #1e3c72;">${safeGet(hotel, 'pricePerNight', 'N/A')}/night</strong><br>
                                    <span style="color: #666;">Total: ${safeGet(hotel, 'totalCost', 'N/A')}</span>
                                </div>
                                ${hotel.bookingLink ? `<a href="${hotel.bookingLink}" target="_blank" class="btn">Book Now</a>` : ''}
                            </div>
                        </div>
                        ${amenitiesHTML ? `<div class="amenities">${amenitiesHTML}</div>` : ''}
                        ${imagesHTML ? `<div class="hotel-images">${imagesHTML}</div>` : ''}
                        <div class="map-container" id="hotelMap"></div>
                    </div>
                </div>
            `;
            document.getElementById('mainContent').insertAdjacentHTML('beforeend', html);

            // Initialize hotel map
            setTimeout(() => {
                const lat = safeGet(coordinates, 'latitude', 51.5074);
                const lng = safeGet(coordinates, 'longitude', -0.1278);
                if (lat && lng) {
                    const hotelMap = L.map('hotelMap').setView([lat, lng], 15);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(hotelMap);
                    L.marker([lat, lng]).addTo(hotelMap).bindPopup(`<b>${safeGet(hotel, 'name', 'Hotel')}</b>`);
                }
            }, 100);
        }

        // Render daily itinerary
        function renderDailyItinerary(data) {
            const itinerary = safeGet(data, 'dailyItinerary', []);
            
            let html = '<div class="section"><h2 class="section-title">üìÖ Daily Itinerary</h2>';
            
            itinerary.forEach((day, index) => {
                const places = safeGet(day, 'places', []);
                const daySummary = safeGet(day, 'daySummary', {});
                
                html += `
                    <div class="day-accordion">
                        <div class="day-header" onclick="toggleDay(${index})">
                            <div>
                                <h3>Day ${safeGet(day, 'day', index + 1)}: ${safeGet(day, 'theme', 'Exploration')}</h3>
                                <div class="day-meta">
                                    <span>üìÖ ${safeGet(day, 'date', 'N/A')}</span>
                                    <span>üö∂ ${safeGet(day, 'totalDistance', 'N/A')} km</span>
                                    <span>‚è±Ô∏è ${safeGet(day, 'totalTravelTime', 'N/A')}</span>
                                </div>
                            </div>
                            <span class="arrow" id="arrow-${index}">‚ñº</span>
                        </div>
                        <div class="day-content" id="day-${index}">
                            <div class="day-details">
                                ${day.weather ? `<div class="weather-info"><strong>üå§Ô∏è Weather Forecast:</strong> ${day.weather}</div>` : ''}
                                
                                <div class="map-container" id="dayMap-${index}"></div>
                                
                                <h4 style="margin: 20px 0; color: #1e3c72;">üìç Places to Visit</h4>
                                ${renderPlaces(places)}
                                
                                <div class="day-summary">
                                    <h4 style="color: #1e3c72; margin-bottom: 15px;">Day ${safeGet(day, 'day', index + 1)} Summary</h4>
                                    <div class="summary-grid">
                                        <div class="summary-item">
                                            <strong>Total Distance</strong>
                                            <div>${safeGet(daySummary, 'totalDistance', 'N/A')}</div>
                                        </div>
                                        ${renderDaySummarySpending(safeGet(daySummary, 'spending', {}))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Initialize day map
                setTimeout(() => {
                    if (places.length > 0) {
                        const mapId = `dayMap-${index}`;
                        const firstPlace = places[0];
                        const coords = safeGet(firstPlace, 'coordinates', {});
                        const lat = safeGet(coords, 'latitude', 51.5074);
                        const lng = safeGet(coords, 'longitude', -0.1278);
                        
                        if (lat && lng) {
                            const dayMap = L.map(mapId).setView([lat, lng], 13);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(dayMap);
                            
                            places.forEach((place, pIndex) => {
                                const pCoords = safeGet(place, 'coordinates', {});
                                const pLat = safeGet(pCoords, 'latitude');
                                const pLng = safeGet(pCoords, 'longitude');
                                
                                if (pLat && pLng) {
                                    L.marker([pLat, pLng])
                                        .addTo(dayMap)
                                        .bindPopup(`<b>${pIndex + 1}. ${safeGet(place, 'name', 'Location')}</b><br>${safeGet(place, 'timeOfDay', '')}`);
                                }
                            });
                        }
                    }
                }, 200 + (index * 100));
            });
            
            html += '</div>';
            document.getElementById('mainContent').insertAdjacentHTML('beforeend', html);
        }

        // Render places for a day
        function renderPlaces(places) {
            return places.map(place => {
                const activities = safeGet(place, 'activities', []);
                const practicalInfo = safeGet(place, 'practicalInfo', {});
                const tips = safeGet(place, 'tips', {});
                
                return `
                    <div class="place-card">
                        <div class="place-header">
                            <div>
                                <div class="place-title">${safeGet(place, 'name', 'Location')}</div>
                                ${place.whyVisit ? `<p style="color: #667eea; font-style: italic; margin-top: 5px;">Why Visit: ${place.whyVisit}</p>` : ''}
                            </div>
                            <span class="time-badge">${safeGet(place, 'timeOfDay', 'N/A')}</span>
                        </div>
                        
                        <p class="place-description">${safeGet(place, 'description', '')}</p>
                        
                        ${activities.length > 0 ? `
                            <div class="activities-list">
                                <strong>Activities:</strong>
                                <ul>
                                    ${activities.map(a => `<li>${a}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        
                        <div class="practical-info">
                            <div class="info-item">
                                <span class="info-label">Entry Fee</span>
                                <span>${safeGet(practicalInfo, 'entryFee', 'N/A')}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Estimated Cost</span>
                                <span>${safeGet(practicalInfo, 'estimatedCost', 'N/A')}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Duration</span>
                                <span>${safeGet(practicalInfo, 'duration', 'N/A')}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Travel Time</span>
                                <span>${safeGet(place, 'travelTimeFromPrevious', 'N/A')}</span>
                            </div>
                        </div>
                        
                        ${(tips.whatToBring && tips.whatToBring.length > 0) || (tips.safetyNotes && tips.safetyNotes.length > 0) ? `
                            <div class="tips-box">
                                <h5>üí° Tips</h5>
                                ${tips.whatToBring && tips.whatToBring.length > 0 ? `<p><strong>Bring:</strong> ${tips.whatToBring.join(', ')}</p>` : ''}
                                ${tips.safetyNotes && tips.safetyNotes.length > 0 ? `<p><strong>Safety:</strong> ${tips.safetyNotes.join('; ')}</p>` : ''}
                            </div>
                        ` : ''}
                        
                        <div class="action-buttons">
                            ${place.googlemapintegrationlink ? `<a href="${place.googlemapintegrationlink}" target="_blank" class="btn">üìç View on Map</a>` : ''}
                            ${place.addtocalendar ? `<a href="${place.addtocalendar}" target="_blank" class="btn">üìÖ Add to Calendar</a>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render day summary spending
        function renderDaySummarySpending(spending) {
            return Object.entries(spending).map(([key, value]) => `
                <div class="summary-item">
                    <strong>${key.charAt(0).toUpperCase() + key.slice(1)}</strong>
                    <div>${value}${key !== 'total' ? ' ' + currency : ''}</div>
                </div>
            `).join('');
        }

        // Render budget
        function renderBudget(data) {
            const budget = safeGet(data, 'budgetBreakdown', {});
            const expenses = safeGet(budget, 'expenses', {});
            const dailyExpenses = safeGet(expenses, 'dailyExpenses', []);
            const transport = safeGet(expenses, 'Transport', [{}]);
            const accommodation = safeGet(expenses, 'accommodation', {});
            const budgetTips = safeGet(budget, 'budgetTips', []);
            
            let dailyExpensesHTML = dailyExpenses.map(d => `
                <tr>
                    <td>Day ${safeGet(d, 'day', 'N/A')}</td>
                    <td>${safeGet(d, 'cost', 'N/A')}</td>
                </tr>
            `).join('');

            let tipsHTML = budgetTips.map(tip => `<li>${tip}</li>`).join('');
            
            const html = `
                <div class="section">
                    <h2 class="section-title">üí∞ Budget Breakdown</h2>
                    <div class="budget-section">
                        <h3>Total Budget: ${safeGet(budget, 'totalBudget', 'N/A')}</h3>
                        
                        <div class="budget-grid">
                            <div class="budget-item">
                                <h4>Flights</h4>
                                <div class="budget-amount">${safeGet(transport[0], 'total_cost', 'N/A')}</div>
                            </div>
                            <div class="budget-item">
                                <h4>Accommodation</h4>
                                <div class="budget-amount">${safeGet(accommodation, 'total', 'N/A')}</div>
                                <small>${safeGet(accommodation, 'nights', 'N/A')} nights</small>
                            </div>
                            <div class="budget-item">
                                <h4>Total Spent</h4>
                                <div class="budget-amount">${safeGet(budget, 'totalSpent', 'N/A')}</div>
                            </div>
                            <div class="budget-item">
                                <h4>Remaining</h4>
                                <div class="budget-amount">${safeGet(budget, 'remainingBudget', 'N/A')}</div>
                            </div>
                        </div>
                        
                        ${dailyExpensesHTML || tipsHTML ? `
                            <div class="daily-spending">
                                ${dailyExpensesHTML ? `
                                    <h4>Daily Expenses</h4>
                                    <table class="spending-table">
                                        <thead>
                                            <tr>
                                                <th>Day</th>
                                                <th>Cost</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${dailyExpensesHTML}
                                        </tbody>
                                    </table>
                                ` : ''}
                                
                                ${tipsHTML ? `
                                    <div style="margin-top: 20px;">
                                        <h4>üí° Budget Tips</h4>
                                        <ul style="margin-top: 10px; line-height: 1.8;">
                                            ${tipsHTML}
                                        </ul>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            document.getElementById('mainContent').insertAdjacentHTML('beforeend', html);
        }

        // Render packing list
        function renderPackingList(data) {
            const packing = safeGet(data, 'packingList', {});
            
            let html = '<div class="section"><h2 class="section-title">üéí Packing List</h2><div class="packing-list">';
            
            Object.entries(packing).forEach(([category, items]) => {
                if (Array.isArray(items) && items.length > 0) {
                    html += `
                        <div class="packing-category">
                            <h4>${category.charAt(0).toUpperCase() + category.slice(1).replace(/([A-Z])/g, ' $1')}</h4>
                            <ul>
                                ${items.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            });
            
            html += '</div></div>';
            document.getElementById('mainContent').insertAdjacentHTML('beforeend', html);
        }

        // Render checklist
        function renderChecklist(data) {
            const checklist = safeGet(data, 'preTripChecklist', {});
            
            const priorities = {
                highPriority: { name: 'High Priority', color: '#e74c3c' },
                mediumPriority: { name: 'Medium Priority', color: '#f39c12' },
                lowPriority: { name: 'Low Priority', color: '#2ecc71' }
            };
            
            let html = '<div class="section"><h2 class="section-title">‚úì Pre-Trip Checklist</h2>';
            
            Object.entries(priorities).forEach(([key, config]) => {
                const items = safeGet(checklist, key, []);
                if (items.length > 0) {
                    html += `
                        <div class="checklist">
                            <h4 style="color: ${config.color};">${config.name}</h4>
                            <ul>
                                ${items.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            document.getElementById('mainContent').insertAdjacentHTML('beforeend', html);
        }

        // Toggle day accordion
        function toggleDay(index) {
            const content = document.getElementById(`day-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);
            
            content.classList.toggle('active');
            arrow.classList.toggle('active');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', loadItinerary);
    </script>
</body>
</html>
